<!doctype html>
<html>

<head>
	<title>Pybbo</title>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
	 crossorigin="anonymous">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.1.1/socket.io.slim.js"></script>
	<!-- Custom styles for this template -->
	<link href="{{ url_for('static', filename='css/starter-template.css') }}" rel="stylesheet">
	<link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">
	{{ moment.include_jquery() }}
	{{ moment.include_moment() }}
</head>

<body>

	<nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">
		<a class="navbar-brand" href="#">Hour of Code 2018</a>
	</nav>

	<main role="main" class="container">
		<div class="starter-template">
			<h1>Guestbook:</h1>
			<div class="list-group comment-list">
				{% for comment in comments %}
				<a href="#" class="list-group-item list-group-item-action flex-column align-items-start">
					<div class="d-flex w-100 justify-content-between">
						<h5 class="mb-1">{{ comment.title }}</h5>
						<small class="mb-1">{{ comment.author }}</small>
					</div>
					<p class="mb-1">{{ comment.content }}</p>
					<div class="d-flex flex-row justify-content-end">
						<small class="mb-1">{{ moment(comment.datetime).fromNow() }}</small>
					</div>
				</a>
				{% endfor %}
				<div class="list-group-item list-group-item-action d-flex justify-content-end">
					<small>Users connected <span id="users">0</span></small>
				</div>
			</div>
			<div class="comment-form">
				<form method="POST">
					<div class="form-group">
						<label for="author">Author</label>
						<input type="author" class="form-control" id="author" name="author" placeholder="Author" required>
					</div>
					<div class="form-group">
						<label for="title">Title</label>
						<input type="title" class="form-control" id="title" name="title" placeholder="Title" required>
					</div>
					<div class="form-group">
						<label for="content">Example textarea</label>
						<textarea class="form-control" id="content" name="content" rows="3" placeholder="Content" required></textarea>
					</div>
					<button type="submit" class="btn btn-primary push-right">Submit</button>
				</form>
			</div>
		</div>
	</main>

	<script>
		const socket = io();

		function update_users(users) {
			document.getElementById('users').innerHTML = ''+users;
		}

		socket.on('new connection', function(data) {
			update_users(data.users);
			console.log('new connection');
		});

		socket.on('new disconnection', function(data) {
			update_users(data.users);
			console.log('new disconnection');
		});
	</script>

	<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
	 crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
	 crossorigin="anonymous"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
	 crossorigin="anonymous"></script>
</body>

</html>